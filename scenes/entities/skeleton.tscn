[gd_scene load_steps=24 format=3 uid="uid://c4d4wct4t154q"]

[ext_resource type="Script" uid="uid://c0ldi3lck865l" path="res://src/entities/skeleton.gd" id="1_34uab"]
[ext_resource type="Texture2D" uid="uid://pewpox3rcuxn" path="res://assets/textures/entities/skeleton.png" id="1_qxc4t"]
[ext_resource type="PackedScene" uid="uid://bnp1ebkhlabic" path="res://scenes/objects/remains.tscn" id="2_87w4c"]
[ext_resource type="PackedScene" uid="uid://c2xqcv0u882e7" path="res://scenes/components/health_component.tscn" id="2_l7dce"]
[ext_resource type="AudioStream" uid="uid://cbk2qlppdecc8" path="res://assets/audio/entity_hit.wav" id="3_r3082"]
[ext_resource type="Script" uid="uid://ckk3hymu1aas1" path="res://src/fsm/state_machine.gd" id="5_ed2xj"]
[ext_resource type="Script" uid="uid://btfnnf5d4ep8l" path="res://src/fsm/state.gd" id="6_jsnsc"]
[ext_resource type="Script" uid="uid://cnp5wfapp5ywh" path="res://src/fsm/undead_idle_state.gd" id="6_sb2t5"]
[ext_resource type="Script" uid="uid://0libej2ct2ft" path="res://src/fsm/undead_wander_state.gd" id="7_sb2t5"]
[ext_resource type="PackedScene" uid="uid://cik5w6l67emf7" path="res://scenes/components/health_indicator_component.tscn" id="10_5gv7q"]

[sub_resource type="CapsuleShape2D" id="CapsuleShape2D_l7dce"]
radius = 3.0
height = 12.0

[sub_resource type="RectangleShape2D" id="RectangleShape2D_gsv6m"]
size = Vector2(6, 12)

[sub_resource type="AtlasTexture" id="AtlasTexture_l7dce"]
atlas = ExtResource("1_qxc4t")
region = Rect2(0, 0, 16, 16)

[sub_resource type="AtlasTexture" id="AtlasTexture_34uab"]
atlas = ExtResource("1_qxc4t")
region = Rect2(16, 0, 16, 16)

[sub_resource type="AtlasTexture" id="AtlasTexture_r0p64"]
atlas = ExtResource("1_qxc4t")
region = Rect2(32, 0, 16, 16)

[sub_resource type="AtlasTexture" id="AtlasTexture_kycrw"]
atlas = ExtResource("1_qxc4t")
region = Rect2(48, 0, 16, 16)

[sub_resource type="AtlasTexture" id="AtlasTexture_uh3l3"]
atlas = ExtResource("1_qxc4t")
region = Rect2(64, 0, 16, 16)

[sub_resource type="AtlasTexture" id="AtlasTexture_bmtsy"]
atlas = ExtResource("1_qxc4t")
region = Rect2(80, 0, 16, 16)

[sub_resource type="AtlasTexture" id="AtlasTexture_b25yd"]
atlas = ExtResource("1_qxc4t")
region = Rect2(96, 0, 16, 16)

[sub_resource type="AtlasTexture" id="AtlasTexture_d760r"]
atlas = ExtResource("1_qxc4t")
region = Rect2(112, 0, 16, 16)

[sub_resource type="AtlasTexture" id="AtlasTexture_m40r2"]
atlas = ExtResource("1_qxc4t")
region = Rect2(128, 0, 16, 16)

[sub_resource type="AtlasTexture" id="AtlasTexture_s3j7l"]
atlas = ExtResource("1_qxc4t")
region = Rect2(144, 0, 16, 16)

[sub_resource type="SpriteFrames" id="SpriteFrames_57td1"]
animations = [{
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_l7dce")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_34uab")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_r0p64")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_kycrw")
}],
"loop": true,
"name": &"idle",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_uh3l3")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_bmtsy")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_b25yd")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_d760r")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_m40r2")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_s3j7l")
}],
"loop": true,
"name": &"walk",
"speed": 5.0
}]

[node name="Skeleton" type="CharacterBody2D"]
script = ExtResource("1_34uab")
remains_tscn = ExtResource("2_87w4c")

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
shape = SubResource("CapsuleShape2D_l7dce")

[node name="HealthComponent" parent="." node_paths=PackedStringArray("sprite") instance=ExtResource("2_l7dce")]
hit_sound_stream = ExtResource("3_r3082")
sprite = NodePath("../AnimatedSprite2D")

[node name="CollisionShape2D2" type="CollisionShape2D" parent="HealthComponent"]
shape = SubResource("RectangleShape2D_gsv6m")

[node name="NavigationAgent2D" type="NavigationAgent2D" parent="."]
path_desired_distance = 8.0
debug_enabled = true

[node name="AnimatedSprite2D" type="AnimatedSprite2D" parent="."]
sprite_frames = SubResource("SpriteFrames_57td1")
animation = &"walk"
autoplay = "idle"
offset = Vector2(-1, -2)

[node name="UndeadStateMachine" type="Node" parent="." node_paths=PackedStringArray("initial_state")]
script = ExtResource("5_ed2xj")
initial_state = NodePath("UndeadIdleState")
metadata/_custom_type_script = "uid://ckk3hymu1aas1"

[node name="UndeadIdleState" type="Node" parent="UndeadStateMachine" node_paths=PackedStringArray("anim_sprite")]
script = ExtResource("6_sb2t5")
anim_sprite = NodePath("../../AnimatedSprite2D")
metadata/_custom_type_script = "uid://btfnnf5d4ep8l"

[node name="UndeadWanderState" type="Node" parent="UndeadStateMachine" node_paths=PackedStringArray("char_body", "nav_agent", "anim_sprite")]
script = ExtResource("7_sb2t5")
wander_movement_speed = 50.0
wander_radius = 128.0
char_body = NodePath("../..")
nav_agent = NodePath("../../NavigationAgent2D")
anim_sprite = NodePath("../../AnimatedSprite2D")
metadata/_custom_type_script = "uid://btfnnf5d4ep8l"

[node name="UndeadFollowState" type="Node" parent="UndeadStateMachine"]
script = ExtResource("6_jsnsc")
metadata/_custom_type_script = "uid://btfnnf5d4ep8l"

[node name="HealthIndicatorComponent" parent="." node_paths=PackedStringArray("health_component") instance=ExtResource("10_5gv7q")]
health_component = NodePath("../HealthComponent")

[connection signal="died" from="HealthComponent" to="." method="_on_health_component_died"]
